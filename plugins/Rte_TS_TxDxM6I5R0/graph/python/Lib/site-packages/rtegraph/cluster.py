"""
 Copyright (C) Elektrobit Automotive GmbH
 All rights exclusively reserved for Elektrobit Automotive GmbH,
 unless expressly agreed to otherwise.
"""

from collections import OrderedDict

## Class representing one Cluster
class Cluster :
    def __init__(self, id, label, color):
        """
        CTor creates new Cluster
        :param id: id of the new cluster
        :param label: label to be added in the graph for the cluster
        :param color: font color of the label
        """ 
        self.id = id
        self.label = label
        self._color = color
        self._nodes = OrderedDict()
        self.clusters = {}
        self._connections = {}


    def add_cluster(self, cluster):
        """
        Adds a sub-cluster inside the current cluster.
        :param cluster: the cluster to be added
        """ 
        self.clusters[cluster.id] = cluster


    def add_node(self, node):
        """
        Adds a node to the cluster.
        :param node: node to be added
        """ 
        self._nodes[node.id] = node


    def _get_last_added_node(self):
        """
        :return: the last node added to the cluster
        """
        last_key = list(self._nodes.keys())[- 1]
        return self._nodes[last_key]


    def add_connection(self, connection):
        """
        Adds a connection to the cluster.
        :param connection: connection to be added
        """ 
        self._connections[connection.get_id()] = connection


    def generate(self, main_graph):
        """
        Generate the contents(nodes, connection, sub-clusters etc) inside the cluster.
        :param main_graph: the graph that will contain this self cluster
        """ 
        with main_graph.subgraph(name = 'cluster' + self.id) as sub_graph:
            sub_graph.attr(label=self.label)
            if len(self.clusters) > 0:
                for cluster in self.clusters.values():
                    cluster.generate(sub_graph)
            for node in self._nodes.values():
                node.generate(sub_graph)
            for connection in self._connections.values():
                connection.generate(sub_graph)


    def __repr__(self):
        return 'Cluster(' + self.label + ',' + str(self.id) + ')'
